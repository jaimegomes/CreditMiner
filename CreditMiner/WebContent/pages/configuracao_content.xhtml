<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

	<main> 
	<nav class="navbar navbar-default">
		<div class="container-fluid">
			<div class="navbar-header">
				<a class="navbar-brand" style="height: auto" href="#"> <img
					alt="SCconsig Promotora de Crédito"
					src="resources/images/scconsig.png" />
				</a>
			</div>	
			<h:form id="barraDeFerramentas">
			<div class="navbar-right navbar-text cursor" data-toggle="dropdown" data-target=".user-dropdown">
				<i class="fa fa-user"></i> Painel de Controle<b class="caret"></b>
			   	<ul class="nav navbar-nav navbar-user navbar-right">
	                <li class="dropdown user-dropdown">
	                    <ul class="dropdown-menu">
	                        <li><h:commandLink styleClass="fa fa-power-off" value="Sair" action="#{navegadorMB.sair()}"
									onclick="pollStatus.stop()" ajax="false"/>
							</li>
	                    </ul>
	                </li>
	            </ul>
            </div>
            </h:form> 
		</div>
	</nav>
	
	<div class="container-fluid main-container">
		<div class="col-md-12 content">
			<div class="panel panel-default">
				<div class="panel-heading">

					<h:form id="form" enctype="multipart/form-data"
						styleClass="form-horizontal">

						<h:outputLabel value="Arquivo" styleClass="control-label col-md-2"
							class="text-right" />
						<h:inputFile id="file" value="#{navegadorMB.fileController.file}"
							label="Arquivo" styleClass="form-control" required="true"/>

						<br></br>
						<h:commandButton value="Iniciar"
							action="#{navegadorMB.initMiner()}" onclick="pollStatus.start()"
							styleClass="btn btn-sm btn-primary" render="tabela_downloads">
							<f:ajax execute="@form" render="@all"/>
						</h:commandButton>
					</h:form>

				</div>
				<div class="panel-body">
					<div class="container">
						<div class="row">

							<h:form id="tabela_downloads">
								<div class="col-md-12">

									<h4>
										<h:outputText id="txt_count"
											value="#{navegadorMB.mensagemDoStatus}" />
									</h4>
									<p:poll interval="2"
										listener="#{navegadorMB.atualizaStatusProcesso}"
										update="txt_count" widgetVar="pollStatus" autoStart="false"/>

									<div class="table-responsive">

										<h:dataTable id="tableArquivosProcessados"
											value="#{navegadorMB.fileController.listArquivosProcessados}"
											var="arquivoProcessado"
											styleClass="table table-bordred table-striped">
											<h:column>
												<f:facet name="header">Nome do arquivo</f:facet>
												<h:outputText value="#{arquivoProcessado.name}"></h:outputText>
											</h:column>

											<h:column>
												<f:facet name="header">Download	<span
														class="glyphicon glyphicon-download-alt"></span>
												</f:facet>
												<p data-placement="top" data-toggle="tooltip"
													title="Download">
													<h:commandLink
														action="#{navegadorMB.fileController.download()}"
														styleClass="btn btn-success btn-xs" data-title="Download"
														data-toggle="modal">
														<span class="glyphicon glyphicon-download-alt"></span>
														<f:param name="file" value="#{arquivoProcessado}" />
													</h:commandLink>
												</p>
											</h:column>

											<h:column>
												<f:facet name="header">Excluir <span
														class="glyphicon glyphicon-trash"></span>
												</f:facet>
												<p data-placement="top" data-toggle="tooltip" title="Delete">
													<h:commandLink
														action="#{navegadorMB.fileController.excluir(arquivoProcessado)}"
														styleClass="btn btn-danger btn-xs" data-title="Excluir"
														data-toggle="modal" render="tabela_downloads">
														<f:ajax execute="@form" render="@form" />
														<span class="glyphicon glyphicon-trash"></span>
													</h:commandLink>
												</p>
											</h:column>

										</h:dataTable>
									</div>
								</div>
							</h:form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	</main>
</ui:composition>
